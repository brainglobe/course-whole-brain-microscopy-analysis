<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <title>Whole brain microscopy analysis</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #383a42;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #383a42; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #50a14f; } /* Annotation */
    code span.at { color: #a626a4; } /* Attribute */
    code span.bn { color: #986801; } /* BaseN */
    code span.bu { color: #a626a4; } /* BuiltIn */
    code span.cf { color: #a626a4; } /* ControlFlow */
    code span.ch { color: #50a14f; } /* Char */
    code span.cn { color: #986801; } /* Constant */
    code span.co { color: #a0a1a7; font-style: italic; } /* Comment */
    code span.cv { color: #e45649; font-style: italic; } /* CommentVar */
    code span.do { color: #e45649; } /* Documentation */
    code span.dt { color: #a626a4; } /* DataType */
    code span.dv { color: #986801; } /* DecVal */
    code span.er { color: #f44747; text-decoration: underline; } /* Error */
    code span.ex { color: #4078f2; font-weight: bold; } /* Extension */
    code span.fl { color: #986801; } /* Float */
    code span.fu { color: #4078f2; } /* Function */
    code span.im { color: #50a14f; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #a626a4; } /* Keyword */
    code span.op { color: #a626a4; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #a626a4; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #0184bc; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #50a14f; } /* String */
    code span.va { color: #e45649; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Whole brain microscopy analysis</h1>
  <p class="subtitle">With BrainGlobe and napari</p>

<div class="quarto-title-authors">
</div>

</section>
<section>
<section id="welcome" class="title-slide slide level1 center">
<h1>Welcome</h1>

</section>
<section id="schedule" class="slide level2 smaller">
<h2>Schedule</h2>
<div>
<ul>
<li class="fragment">Installing BrainGlobe and Napari (30 mins)</li>
<li class="fragment">Introduction to Image analysis with Napari (60 mins)</li>
<li class="fragment">Introduction to BrainGlobe (30 mins)</li>
<li class="fragment">Registering whole brain microscopy images with brainreg (30 mins)</li>
<li class="fragment">Segmenting structures in whole brain microscopy images with brainglobe-segmentation (30 mins)</li>
<li class="fragment">Detecting cells in large 3D images with cellfinder (90 mins)</li>
<li class="fragment">Analysing cell positions in atlas space (30 mins)</li>
<li class="fragment">Visualisation of data in atlas space with brainrender and brainrender-napari (30 mins)</li>
<li class="fragment">Tour of other BrainGlobe tools and wrap-up (30 mins)</li>
</ul>
</div>
</section></section>
<section>
<section id="installation" class="title-slide slide level1 center">
<h1>Installation</h1>

</section>
<section id="install-napari-and-brainglobe" class="slide level2">
<h2>Install napari and BrainGlobe</h2>
<h3 id="everyone">Everyone</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href=""></a><span class="ex">conda</span> create <span class="at">-n</span> brainglobe-env python=3.12</span>
<span id="cb1-2"><a href=""></a><span class="ex">conda</span> activate brainglobe-env</span>
<span id="cb1-3"><a href=""></a><span class="ex">pip</span> install brainglobe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h4 id="silicon-mac-users-additionally">Silicon mac users (additionally)</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href=""></a><span class="ex">conda</span> install niftyreg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="double-check-installation" class="slide level2 smaller">
<h2>Double-check installation</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Double-check that running</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href=""></a><span class="ex">napari</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>opens a new <code>napari</code> window, with brainglobe plugins available under <code>Plugins</code>.</p>
</div><div class="column" style="width:50%;">
<p><img data-src="img/napari-plugins.png"></p>
</div></div>
</section>
<section id="install-brainglobe-atlases" class="slide level2">
<h2>Install BrainGlobe atlases</h2>
<p>Run</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href=""></a><span class="ex">brainglobe</span> install <span class="at">-a</span> allen_mouse_50um</span>
<span id="cb4-2"><a href=""></a><span class="ex">brainglobe</span> install <span class="at">-a</span> allen_mouse_10um</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To check whether this worked:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href=""></a><span class="ex">brainglobe</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="image-analysis" class="title-slide slide level1 center">
<h1>Image Analysis</h1>
<p>Adapted from <a href="https://github.com/HealthBioscienceIDEAS/microscopy-novice/">https://github.com/HealthBioscienceIDEAS/microscopy-novice/</a> (under CC BY 4.0 license)</p>
</section>
<section id="opening-napari" class="slide level2">
<h2>Opening Napari</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href=""></a><span class="ex">napari</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/blank-napari-ui.png" alt="A screenshot of the default Napari user  interface" class="r-stretch"></section>
<section id="opening-images" class="slide level2">
<h2>Opening images</h2>
<p><code>File &gt; Open Files(s)</code>, then navigate to <code>calcium imaging folder</code> and open <code>translation1_00001_ce.tif</code></p>

<img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells" class="r-stretch"></section>
<section id="naparis-user-interface" class="slide level2">
<h2>Napari’s User interface</h2>

<img data-src="img/ui-sections-napari.png" alt="A screenshot of Napari with the main user  interface sections labelled" class="r-stretch"></section>
<section id="main-menu" class="slide level2">
<h2>Main menu</h2>

<img data-src="img/ui-sections-napari.png" alt="A screenshot of Napari with the main user  interface sections labelled" class="r-stretch"><aside class="notes">
<p>We already used the main menu in the last section to view the BrainGlobe plugins. The main menu contains various commands for opening images, changing preferences and installing plugins (we’ll see more of these options in later episodes).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="canvas" class="slide level2">
<h2>Canvas</h2>
<p>Try moving around the image with the following commands:</p>
<pre><code>Pan - Click and drag
Zoom - Scroll in/out</code></pre>

<img data-src="img/cells-napari-pan-zoom.png" alt="A screenshot of a some fluorescent cells, closer up than before." class="r-stretch"></section>
<section id="dimension-sliders" class="slide level2">
<h2>Dimension sliders</h2>
<p><img data-src="img/dim-slider-closeup.png" style="width:80.0%" alt="Closeup of Napari's dimension slider with labels"></p>
<p><img data-src="img/dim-slider-0.png" style="width:30.0%" alt="Three screenshots of the cells image in napari, at  different z depths"> <img data-src="img/dim-slider-50.png" style="width:30.0%" alt="Three screenshots of the cells image in napari, at  different z depths"> <img data-src="img/dim-slider-100.png" style="width:30.0%" alt="Three screenshots of the cells image in napari, at  different z depths"></p>
<aside class="notes">
<p>Dimension sliders appear at the bottom of the canvas depending on the type of image displayed. For example, here we have a 3D image of some cells, which consists of a stack of 2D images. If we drag the slider at the bottom of the image, we move up and down in this stack:</p>
<p>Pressing the arrow buttons at either end of the slider steps through one slice at a time. Also, pressing the ‘play’ button at the very left of the slider moves automatically through the stack until pressed again.</p>
<p>We will see in later episodes that more sliders can appear if our image has more dimensions (e.g.&nbsp;time series, or further channels).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="viewer-buttons" class="slide level2 smaller">
<h2>Viewer buttons</h2>
<p>The viewer buttons (the row of buttons at the bottom left of Napari) control various aspects of the Napari viewer:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>Console <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/console.svg" alt="A screenshot of Napari's console button" height="30"></p></li>
<li><p>2D/3D <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/2D.svg" alt="A screenshot of Napari's 2D button" height="25"> / <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/3D.svg" alt="A screenshot of Napari's 3D button" height="25"></p></li>
<li><p>Roll dimensions <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/roll.svg" alt="A screenshot of Napari's roll dimensions button" height="25"></p></li>
<li><p>Transpose dimensions <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/transpose.svg" alt="A screenshot of Napari's transpose dimensions button" height="25"></p></li>
<li><p>Grid <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/grid.svg" alt="A screenshot of Napari's grid button" height="25"></p></li>
<li><p>Home <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/home.svg" alt="A screenshot of Napari's home button" height="25"></p></li>
</ul>
</div><div class="column" style="width:50%;">
<p><img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells"></p>
</div></div>
</section>
<section id="layer-list" class="slide level2">
<h2>Layer list</h2>

<img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells" class="r-stretch"><aside class="notes">
<p>We can show/hide each layer by clicking the eye icon on the left side of their row. We can also rename them by double clicking on the row.</p>
<p>We can change the order of layers by dragging and dropping items in the layer list. For example, try dragging the membrane layer above the nuclei. You should see the nuclei disappear from the viewer (as they are now hidden by the membrane image on top).</p>
<p>Now that we’ve seen the main controls for the viewer, let’s look at the layer list. ‘Layers’ are how Napari displays multiple items together in the viewer. For example, currently our layer list contains two items - ‘nuclei’ and ‘membrane’. These are both <code>Image</code> layers and are displayed in order, with the nuclei on top and membrane underneath.</p>
<p>Here we only have <code>Image</code> layers, but there are many more types like <code>Points</code>, <code>Shapes</code> and <code>Labels</code>, some of which we will see <a href="#/layer-buttons">later in the episode</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="layer-controls" class="slide level2">
<h2>Layer controls</h2>
<p>This area shows controls only for the currently selected layer (i.e.&nbsp;the one that is highlighted in blue in the layer list).</p>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>Opacity<br>
</li>
<li>Contrast limits</li>
<li>…</li>
</ul>
</div><div class="column" style="width:60%;">
<p><img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells"></p>
</div></div>
<aside class="notes">
<p>This changes the opacity of the layer - lower values are more transparent. For example, reducing the opacity of the membrane layer (if it is still on top of the nuclei), allows us to see the nuclei again.</p>
<p>briefly - the contrast limits adjust what parts of the image we can see and how bright they appear in the viewer. Moving the left node adjusts what is shown as fully black, while moving the right node adjusts what is shown as fully bright. This doesn’t change the values in the image, just how they are displayed.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="layer-buttons" class="slide level2">
<h2>Layer buttons</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Create and remove.</p>
<ul>
<li><p>Points <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/new_points.svg" alt="A screenshot of Napari's point layer button" height="30"></p></li>
<li><p>Shapes <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/new_shapes.svg" alt="A screenshot of Napari's shape layer button" height="30"></p></li>
<li><p>Labels <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/new_labels.svg" alt="A screenshot of Napari's labels layer button" height="30"></p></li>
<li><p>Remove layer <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/delete.svg" alt="A screenshot of Napari's delete layer button" height="30"><br>
</p></li>
</ul>
</div><div class="column" style="width:55%;">
<p><img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells"></p>
</div></div>
</section>
<section id="other-layer-types" class="slide level2">
<h2>Other layer types</h2>
<p>Note that there are some layer types that can’t be added via clicking buttons in the user interface, like</p>
<ul>
<li><a href="https://napari.org/stable/howtos/layers/surface.html">surfaces</a>,</li>
<li><a href="https://napari.org/stable/howtos/layers/tracks.html">tracks</a> and</li>
<li><a href="https://napari.org/stable/howtos/layers/vectors.html">vectors</a>.</li>
</ul>
<p>These require calling python commands in Napari’s console or an external python script.</p>
</section>
<section id="key-points" class="slide level2">
<h2>Key points</h2>
<ul>
<li>Napari’s user interface is split into a few main sections including the canvas, layer list, layer controls…</li>
<li>Layers can be of different types e.g.&nbsp;<code>Image</code>, <code>Point</code>, <code>Label</code></li>
<li>Different layer types have different layer controls</li>
</ul>
</section>
<section id="a-deeper-look" class="slide level2">
<h2>A deeper look</h2>
<p><code>File &gt; Open Files(s)</code>, then navigate to <code>calcium imaging folder</code> and open <code>translation1_00001_ce.tif</code></p>

<img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells" class="r-stretch"></section>
<section id="pixels" class="slide level2">
<h2>Pixels</h2>
<aside class="notes">
<p>This 2D image shows the nuclei of human cells undergoing mitosis. If we really zoom in up-close by scrolling, we can see that this image is actually made up of many small squares with different brightness values. These squares are the image’s pixels (or ‘picture elements’) and are the individual units that make up all digital images.</p>
<p>If we hover over these pixels with the mouse cursor, we can see that each pixel has a specific value. Try hovering over pixels in dark and bright areas of the image and see how the value changes in the bottom left of the viewer:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="img/pixel-value.png" alt="A screenshot of Napari - with the mouse cursor  hovering over a pixel and highlighting the corresponding pixel value" class="r-stretch"></section>
<section id="images-are-arrays-of-numbers" class="slide level2 smaller">
<h2>Images are arrays of numbers</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>Open Napari’s built-in console <img data-src="https://raw.githubusercontent.com/napari/napari/main/napari/resources/icons/console.svg" alt="A screenshot of Napari's console button" height="30"> and run:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="co"># Get the image data for the first layer in Napari</span></span>
<span id="cb8-2"><a href=""></a>image <span class="op">=</span> viewer.layers[<span class="dv">0</span>].data</span>
<span id="cb8-3"><a href=""></a></span>
<span id="cb8-4"><a href=""></a><span class="co"># Print the image values and type</span></span>
<span id="cb8-5"><a href=""></a><span class="bu">print</span>(image)</span>
<span id="cb8-6"><a href=""></a><span class="bu">print</span>(<span class="bu">type</span>(image))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:55%;">
<p><img data-src="img/napari-console.png" alt="A screenshot of Napari's console"></p>
</div></div>
<aside class="notes">
<p>We’ve seen that images are made of individual units called pixels that have specific values - but how is an image really represented in the computer? Let’s dig deeper into Napari’s <code>Image</code> layers…</p>
<p>All of the information about the Napari viewer can be accessed through the console with a variable called <code>viewer</code>. A <code>viewer</code> has 1 to many layers, and here we access the top (first) layer with <code>viewer.layers[0]</code>. Then, to access the actual image data stored in that layer, we retrieve it with <code>.data</code>:</p>
<p>You should see that a series of numbers are printed out that are stored in a Python data type called a <code>numpy.ndarray</code>. Fundamentally, this means that all images are really just arrays of numbers (one number per pixel). Arrays are just rectangular grids of numbers, much like a spreadsheet. Napari is reading those values and converting them into squares of particular colours for us to see in the viewer, but this is only to help us interpret the image contents - the numbers are the real underlying data.</p>
<p>In Napari this array is a <code>numpy.ndarray</code>. <a href="https://numpy.org/">NumPy</a> is a popular python package that provides ‘n-dimensional arrays’ (or ‘ndarray’ for short). N-dimensional just means they can support any number of dimensions - for example, 2D (squares/rectangles of numbers), 3D (cubes/cuboids of numbers) and beyond (like time series, images with many channels etc. where we would have multiple rectangles or cuboids of data which provide further information all at the same location).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="image-dimensions" class="slide level2">
<h2>Image dimensions</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>We can find out the dimensions by running the following in Napari’s console:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a>image.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column" style="width:55%;">
<p><img data-src="img/napari-console.png" alt="A screenshot of Napari's console"></p>
</div></div>
<aside class="notes">
<p>Let’s return to our image and explore some of the key features of its image array. First, what size is it?</p>
<p>The array size (also known as its dimensions) is stored in the <code>.shape</code>. Three values are printed as this image is three dimensional (3D), for a 2D image there would be 2, for a 4D image there would be 4 and so on…</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="image-data-type" class="slide level2">
<h2>Image data type</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p>The other key feature of an image array is its ‘data type’ - this controls which values can be stored inside of it.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>image.dtype.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The data type consists of type and bit-depth.</p>
</div><div class="column" style="width:55%;">
<p><img data-src="img/napari-console.png" alt="A screenshot of Napari's console"></p>
</div></div>
<aside class="notes">
<p>For example, let’s look at the data type for our image - this is stored in <code>.dtype</code>:</p>
<p>We see that the data type (or ‘dtype’ for short) is <code>uint16</code>. This is short for ‘unsigned integer 16-bit’. Let’s break this down further into two parts - the type (unsigned integer) and the bit-depth (16-bit).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="type" class="slide level2">
<h2>Type</h2>
<p>The type determines what kind of values can be stored in the array, for example:</p>
<ul>
<li>Unsigned integer: positive whole numbers</li>
<li>Signed integer: positive and negative whole numbers</li>
<li>Float: positive and negative numbers with a decimal point e.g.&nbsp;3.14</li>
</ul>
<aside class="notes">
<p>For our calcium image, ‘unsigned integer’ means that only positive whole numbers can be stored inside. You can see this by hovering over the pixels in the image again in Napari - the pixel value down in the bottom left is always a positive whole number.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="bit-depth" class="slide level2">
<h2>Bit depth</h2>
<p>The bit depth determines the range of values that can be stored e.g.&nbsp;only values between 0 and <span class="math inline">\(2^{16}-1\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href=""></a><span class="bu">print</span>(image.<span class="bu">min</span>())</span>
<span id="cb11-2"><a href=""></a><span class="bu">print</span>(image.<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="common-data-types" class="slide level2 smaller">
<h2>Common data types</h2>
<p>NumPy supports a <a href="https://numpy.org/doc/stable/reference/arrays.scalars.html#sized-aliases">very wide range of data types</a>, but there are a few that are most common for image data:</p>
<table class="caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 37%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">NumPy datatype</th>
<th style="text-align: left;">Full name</th>
<th style="text-align: left;">Range of values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>uint8</code></td>
<td style="text-align: left;">Unsigned integer 8-bit</td>
<td style="text-align: left;">0…255</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>uint16</code></td>
<td style="text-align: left;">Unsigned integer 16-bit</td>
<td style="text-align: left;">0…65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>float32</code></td>
<td style="text-align: left;">Float 32-bit</td>
<td style="text-align: left;"><span class="math inline">\(-3.4 \times 10^{38}...+3.4 \times 10^{38}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>float64</code></td>
<td style="text-align: left;">Float 64-bit</td>
<td style="text-align: left;"><span class="math inline">\(-1.7 \times 10^{308}...+1.7  \times 10^{308}\)</span></td>
</tr>
</tbody>
</table>
<p><code>uint8</code> and <code>uint16</code> are most common for images from light microscopes. <code>float32</code> and <code>float64</code> are common during image processing (as we will see in later episodes).</p>
</section>
<section id="coordinate-system" class="slide level2 smaller">
<h2>Coordinate system</h2>
<p><img data-src="img/coordinate-system.png" style="width:60.0%" alt="Diagram comparing a standard graph  coordinate system (left) and the image coordinate system (right)"> <img data-src="img/coordinates-on-image.png" style="width:30.0%" alt="A diagram showing how pixel coordinates change over a simple 4x4 image"></p>
<ul>
<li>For 2d images, <code>y</code> is the first coordinate</li>
<li>For 3d images, <code>z</code> is the first coordinate</li>
</ul>
<aside class="notes">
<p>We’ve seen that images are arrays of numbers with a specific shape (dimensions) and data type. How do we access specific values from this array? What coordinate system is Napari using?</p>
<p>As you move around, you should see that the lowest coordinate values are at the top left corner, with the first value increasing as you move down and the second value increasing as you move to the right. This is different to the standard coordinate systems you may be used to (for example, from making graphs):</p>
<p>Note that Napari lists coordinates as [y, x] or [rows, columns], so e.g.&nbsp;[1,3] would be the pixel in row 1 and column 3. Remember that these coordinates always start from 0 as you can see in the diagram:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="key-points-1" class="slide level2">
<h2>Key points</h2>
<ul>
<li>Digital images are made of pixels</li>
<li>Digital images store these pixels as arrays of numbers</li>
<li>Napari (and Python more widely) use NumPy arrays to store images - these have a <code>shape</code> and <code>dtype</code></li>
<li>Most images are 8-bit or 16-bit unsigned integer</li>
<li>Images use a coordinate system with (0,0) at the top left, x increasing to the right, and y increasing down</li>
</ul>
</section>
<section id="processing-images" class="slide level2">
<h2>Processing images</h2>
<p>Now we understand what an image is, and how to look at it in napari, we can start measuring things! But we need to find (“segment”) “things” first!</p>

<img data-src="img/cells-napari.png" alt="A screenshot of a some fluorescent cells" class="r-stretch"></section>
<section id="reduce-noise-with-a-median-filter" class="slide level2">
<h2>Reduce noise with a median filter</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href=""></a><span class="im">from</span> scipy.signal <span class="im">import</span> medfilt2d</span>
<span id="cb12-2"><a href=""></a>image <span class="op">=</span> viewer.layers[<span class="dv">0</span>].data</span>
<span id="cb12-3"><a href=""></a>filtered <span class="op">=</span> medfilt2d(image)</span>
<span id="cb12-4"><a href=""></a>viewer.add_image(filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/filtered.png" alt="A median-filtered version of the example image" class="r-stretch"></section>
<section id="isolate-neurons-with-a-threshold" class="slide level2 smaller">
<h2>Isolate neurons with a threshold</h2>
<p>Example of “semantic” segmentation</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href=""></a>thresholded <span class="op">=</span> filtered <span class="op">&gt;</span> <span class="dv">8000</span> <span class="co"># True or False array</span></span>
<span id="cb13-2"><a href=""></a>thresholded <span class="op">=</span> thresholded<span class="op">*</span><span class="dv">255</span> <span class="co"># convert to unsigned int 8-bit</span></span>
<span id="cb13-3"><a href=""></a>viewer.add_image(thresholded)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/thresholded.png" alt="A thresholded version of the example image" class="r-stretch"></section>
<section id="label-each-neuron-with-a-number" class="slide level2 smaller">
<h2>Label each neuron with a number</h2>
<p>Example of “instance” segmentation</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href=""></a><span class="im">from</span> skimage.measure <span class="im">import</span> regionprops, label</span>
<span id="cb14-2"><a href=""></a>labelled <span class="op">=</span> label(thresholded)</span>
<span id="cb14-3"><a href=""></a>viewer.add_labels(labelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/labelled.png" alt="A labelled version of the example image" class="r-stretch"></section>
<section id="pixels-in-each-neuron" class="slide level2 smaller">
<h2>Pixels in each neuron</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href=""></a>properties <span class="op">=</span> regionprops(labelled)</span>
<span id="cb15-2"><a href=""></a>pixels_in_each_region <span class="op">=</span> [prop.area <span class="cf">for</span> prop <span class="kw">in</span> properties]</span>
<span id="cb15-3"><a href=""></a><span class="bu">print</span>(pixels_in_each_region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<img data-src="img/regionprops.png" alt="A list of pixel counts for each region of the example image" class="r-stretch"></section>
<section id="key-points-2" class="slide level2">
<h2>Key points</h2>
<ul>
<li>Segmentation can be broadly split into ‘semantic segmentation’ (e.g.&nbsp;neuron vs background) and ‘instance segmentation’ (e.g.&nbsp;individual neuron).</li>
<li>Segmentations are represented in the computer in the same way as images, but pixels represent an abstraction, rather than light intensity.</li>
<li>Napari uses “Labels” layers for segmentations.</li>
<li>Segmentation is helpful for analysis.</li>
</ul>
</section></section>
<section>
<section id="brainglobe" class="title-slide slide level1 center">
<h1>BrainGlobe</h1>

</section>
<section id="brainglobe-initiative" class="slide level2 smaller scrollable">
<h2>BrainGlobe Initiative</h2>
<div class="columns">
<div class="column" style="width:55%;">
<p>Established 2020 with three aims:</p>
<div>
<ol type="1">
<li class="fragment">Develop general-purpose tools to help others build interoperable software</li>
<li class="fragment">Develop specialist software for specific analysis and visualisation needs</li>
<li class="fragment">Reduce barriers of entry, and facilitate the building of an ecosystem of computational neuroanatomy tools.</li>
</ol>
</div>
</div><div class="column" style="width:45%;">
<p><img data-src="img/tracing.png"></p>
</div></div>
</section>
<section id="brainglobe-atlas-api" class="slide level2">
<h2>BrainGlobe Atlas API</h2>
<p>Initial observation - lots of similar communities working independently</p>
<ul>
<li>Model species</li>
<li>Imaging modality</li>
<li>Anatomical focus</li>
<li>Developmental stage</li>
</ul>
<div class="footer">
<p><a href="https://doi.org/10.21105/joss.02668">Claudi, F. et al.&nbsp;(2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” JOSS, v5(54), 2668</a></p>
</div>
</section>
<section id="brainglobe-atlas-api-1" class="slide level2">
<h2>BrainGlobe Atlas API</h2>
<h3 id="brainglobe-atlasapi"><a href="https://github.com/brainglobe/brainglobe-atlasapi">brainglobe-atlasapi</a></h3>

<img data-src="img/atlases.png" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p><a href="https://doi.org/10.21105/joss.02668">Claudi, F. et al.&nbsp;(2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” JOSS, v5(54), 2668</a></p>
</div>
</section>
<section id="current-atlases" class="slide level2 smaller">
<h2>Current atlases</h2>
<div style="font-size: 70%;">
<table class="caption-top">
<thead>
<tr class="header">
<th>Atlas Name</th>
<th>Resolution</th>
<th>Ages</th>
<th>Reference Images</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://doi.org/10.1016/j.cell.2020.04.007">Allen Mouse Brain Atlas</a></td>
<td>10, 25, 50, and 100 micron</td>
<td>P56</td>
<td>STPT</td>
</tr>
<tr class="even">
<td><a href="https://www.brain-map.org">Allen Human Brain Atlas</a></td>
<td>100 micron</td>
<td>Adult</td>
<td>MRI</td>
</tr>
<tr class="odd">
<td><a href="http://fishatlas.neuro.mpg.de">Max Planck Zebrafish Brain Atlas</a></td>
<td>1 micron</td>
<td>6-dpf</td>
<td>FISH</td>
</tr>
<tr class="even">
<td><a href="https://kimlab.io/brain-map/atlas/">Enhanced and Unified Mouse Brain Atlas</a></td>
<td>10, 25, 50, and 100 micron</td>
<td>P56</td>
<td>STPT</td>
</tr>
<tr class="odd">
<td><a href="https://doi.org/10.1016/j.celrep.2014.12.014">Smoothed version of the Kim et al.&nbsp;mouse reference atlas</a></td>
<td>10, 25, 50 and 100 micron</td>
<td>P56</td>
<td>STPT</td>
</tr>
<tr class="even">
<td><a href="https://doi.org/10.1007/s12021-020-09490-8">Gubra’s LSFM mouse brain atlas</a></td>
<td>20 micron</td>
<td>8 to 10 weeks post natal</td>
<td>LSFM</td>
</tr>
<tr class="odd">
<td><a href="https://doi.org/10.1101/2021.05.06.443008">3D version of the Allen mouse spinal cord atlas</a></td>
<td>20 x 10 x 10 micron</td>
<td>Adult</td>
<td>Nissl</td>
</tr>
<tr class="even">
<td><a href="https://doi.org/10.1101/2021.05.04.442625">AZBA: A 3D Adult Zebrafish Brain Atlas</a></td>
<td>4 micron</td>
<td>15-16 weeks post natal</td>
<td>LSFM</td>
</tr>
<tr class="odd">
<td><a href="https://doi.org/10.1038/s41592-023-02034-3">Waxholm Space atlas of the Sprague Dawley rat brain</a></td>
<td>39 micron</td>
<td>P80</td>
<td>MRI</td>
</tr>
<tr class="even">
<td><a href="https://doi.org/10.7554/eLife.61408">3D Edge-Aware Refined Atlases Derived from the Allen Developing Mouse Brain Atlases</a></td>
<td>16, 16.75, and 25 micron</td>
<td>E13, E15, E18, P4, P14, P28 &amp; P56</td>
<td>Nissl</td>
</tr>
<tr class="odd">
<td><a href="https://brainmaps.princeton.edu/2020/09/princeton-mouse-brain-atlas-links">Princeton Mouse Brain Atlas</a></td>
<td>20 micron</td>
<td>&gt;P56 (older animals included)</td>
<td>LSFM</td>
</tr>
<tr class="even">
<td><a href="https://data.mendeley.com/datasets/2svx788ddf/1">Kim Lab Developmental CCF</a></td>
<td>10 micron</td>
<td>P56</td>
<td>STP, LSFM (iDISCO) and MRI (a0, adc, dwo, fa, MTR, T2)</td>
</tr>
<tr class="odd">
<td><a href="https://doi.org/10.7554/eLife.80777">Blind Mexican Cavefish Brain Atlas</a></td>
<td>2 micron</td>
<td>1 year</td>
<td>IHC</td>
</tr>
<tr class="even">
<td><a href="https://doi.org/10.1162/imag_a_00209">BlueBrain Barrel Cortex Atlas</a></td>
<td>10 and 25 micron</td>
<td>P56</td>
<td>STPT</td>
</tr>
<tr class="odd">
<td><a href="https://doi.org/10.1038/s41598-021-89357-3">UNAM Axolotl Brain Atlas</a></td>
<td>40 micron</td>
<td>~ 3 months post hatching</td>
<td>MRI</td>
</tr>
</tbody>
</table>
</div>
<div class="footer">
<p><a href="https://doi.org/10.21105/joss.02668">Claudi, F. et al.&nbsp;(2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” JOSS, v5(54), 2668</a></p>
</div>
<div class="footer">
<p><a href="https://doi.org/10.21105/joss.02668">Claudi, F. et al.&nbsp;(2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” JOSS, v5(54), 2668</a></p>
</div>
</section>
<section id="brainglobe-atlas-api-2" class="slide level2 smaller">
<h2>BrainGlobe Atlas API</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href=""></a><span class="im">from</span> brainglobe_atlasapi.bg_atlas <span class="im">import</span> BrainGlobeAtlas</span>
<span id="cb16-2"><a href=""></a>atlas <span class="op">=</span> BrainGlobeAtlas(<span class="st">"allen_mouse_25um"</span>)</span>
<span id="cb16-3"><a href=""></a></span>
<span id="cb16-4"><a href=""></a>reference_image <span class="op">=</span> atlas.reference</span>
<span id="cb16-5"><a href=""></a><span class="bu">print</span>(reference_image.shape)</span>
<span id="cb16-6"><a href=""></a><span class="co"># (528, 320, 456)</span></span>
<span id="cb16-7"><a href=""></a></span>
<span id="cb16-8"><a href=""></a>annotation_image <span class="op">=</span> atlas.annotation</span>
<span id="cb16-9"><a href=""></a><span class="bu">print</span>(annotation_image.shape)</span>
<span id="cb16-10"><a href=""></a><span class="co"># (528, 320, 456)</span></span>
<span id="cb16-11"><a href=""></a></span>
<span id="cb16-12"><a href=""></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb16-13"><a href=""></a>VISp <span class="op">=</span> atlas.structures[<span class="st">"VISp"</span>]</span>
<span id="cb16-14"><a href=""></a>pprint(VISp)</span>
<span id="cb16-15"><a href=""></a></span>
<span id="cb16-16"><a href=""></a><span class="co"># {'acronym': 'VISp',</span></span>
<span id="cb16-17"><a href=""></a><span class="co">#  'id': 385,</span></span>
<span id="cb16-18"><a href=""></a><span class="co">#  'mesh': None,</span></span>
<span id="cb16-19"><a href=""></a><span class="co">#  'mesh_filename': PosixPath('/home/user/.brainglobe/allen_mouse_25um_v0.3/meshes/385.obj'),</span></span>
<span id="cb16-20"><a href=""></a><span class="co">#  'name': 'Primary visual area',</span></span>
<span id="cb16-21"><a href=""></a><span class="co">#  'rgb_triplet': [8, 133, 140],</span></span>
<span id="cb16-22"><a href=""></a><span class="co">#  'structure_id_path': [997, 8, 567, 688, 695, 315, 669, 385]}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="footer">
<p><a href="https://doi.org/10.21105/joss.02668">Claudi, F. et al.&nbsp;(2020) “BrainGlobe Atlas API: a common interface for neuroanatomical atlases” JOSS, v5(54), 2668</a></p>
</div>
</section></section>
<section>
<section id="version-1" class="title-slide slide level1 center">
<h1>Version 1</h1>

</section>
<section id="whole-brain-microscopy" class="slide level2 smaller">
<h2>Whole brain microscopy</h2>
<div class="columns">
<div class="column" style="width:33%;">
<p>Serial section two-photon tomography</p>
</div><div class="column" style="width:33%;">
<p>Fluorescence micro-optical sectioning tomography</p>
</div><div class="column" style="width:33%;">
<p>Light sheet fluorescence microscopy</p>
</div></div>
<div class="footer">
<p><a href="https://doi.org/10.1038/nmeth.2477">Osten, P. , Margrie, T. W. (2013) “Mapping brain circuitry with a light microscope” Nature Methods 10, 515–523</a></p>
</div>

<img data-src="img/microscopy.png" class="quarto-figure quarto-figure-center r-stretch" style="width:110.0%"></section>
<section id="section" class="slide level2">
<h2></h2>

<img data-src="img/whole.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"></section>
<section id="section-1" class="slide level2">
<h2></h2>

<img data-src="img/crop.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"></section>
<section id="whole-brain-registration" class="slide level2">
<h2>Whole-brain registration</h2>
<h3 id="brainreg"><a href="https://github.com/brainglobe/brainreg"><code>brainreg</code></a></h3>

<img data-src="img/brainreg.png" class="quarto-figure quarto-figure-center r-stretch" style="width:110.0%"><div class="footer">
<p><a href="https://doi.org/10.1038/s41598-021-04676-9">Tyson, A. L. et al.&nbsp;(2022) “Accurate determination of marker location within whole-brain microscopy images” Sci Rep, 12, 867</a></p>
</div>
</section>
<section id="d-cell-detection" class="slide level2">
<h2>3D cell detection</h2>
<h3 id="cellfinder"><a href="https://github.com/brainglobe/cellfinder"><code>cellfinder</code></a></h3>

<img data-src="img/raw.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"><div class="footer">
<p><a href="https://doi.org/10.1371/journal.pcbi.1009074">Tyson, A. L. et al.&nbsp;(2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets” PLoS Comp Biol 17(5): e1009074.</a></p>
</div>
</section>
<section id="d-cell-detection-1" class="slide level2">
<h2>3D cell detection</h2>
<h3 id="cellfinder-1"><a href="https://github.com/brainglobe/cellfinder"><code>cellfinder</code></a></h3>

<img data-src="img/detect.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"><div class="footer">
<p><a href="https://doi.org/10.1371/journal.pcbi.1009074">Tyson, A. L. et al.&nbsp;(2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets” PLoS Comp Biol 17(5): e1009074.</a></p>
</div>
</section>
<section id="d-cell-detection-2" class="slide level2">
<h2>3D cell detection</h2>
<h3 id="cellfinder-2"><a href="https://github.com/brainglobe/cellfinder"><code>cellfinder</code></a></h3>

<img data-src="img/classify.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"><div class="footer">
<p><a href="https://doi.org/10.1371/journal.pcbi.1009074">Tyson, A. L. et al.&nbsp;(2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets” PLoS Comp Biol 17(5): e1009074.</a></p>
</div>
</section>
<section id="d-cell-detection-3" class="slide level2">
<h2>3D cell detection</h2>
<h3 id="cellfinder-3"><a href="https://github.com/brainglobe/cellfinder"><code>cellfinder</code></a></h3>

<img data-src="img/cells.png" class="quarto-figure quarto-figure-center r-stretch" style="width:70.0%"><div class="footer">
<p><a href="https://doi.org/10.1371/journal.pcbi.1009074">Tyson, A. L. et al.&nbsp;(2021) “A deep learning algorithm for 3D cell detection in whole mouse brain image datasets” PLoS Comp Biol 17(5): e1009074.</a></p>
</div>
</section>
<section id="spatial-analysis" class="slide level2">
<h2>Spatial analysis</h2>
<h3 id="brainglobe-segmentation"><a href="https://github.com/brainglobe/brainglobe-segmentation"><code>brainglobe-segmentation</code></a></h3>

<img data-src="img/brainglobe-seg.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><div class="footer">
<p><a href="https://doi.org/10.1038/s41598-021-04676-9">Tyson, A. L. et al.&nbsp;(2022) “Accurate determination of marker location within whole-brain microscopy images” Sci Rep, 12, 867</a></p>
</div>
</section>
<section id="spatial-analysis-1" class="slide level2">
<h2>Spatial analysis</h2>
<h3 id="brainglobe-segmentation-1"><a href="https://github.com/brainglobe/brainglobe-segmentation"><code>brainglobe-segmentation</code></a></h3>
<div class="columns">
<div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/bg-seg-users.png" class="quarto-figure quarto-figure-center" style="width:90.0%"></p>
</figure>
</div>
</div><div class="column" style="width:25%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/bg-seg-midvisp.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/bg-seg-means.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div></div>
<div class="footer">
<p><a href="https://doi.org/10.1038/s41598-021-04676-9">Tyson, A. L., Vélez-Fort, M., Rousseau, C. V. et al.&nbsp;(2022) “Accurate determination of marker location within whole-brain microscopy images” Scientific Reports, 12, 867</a></p>
</div>
</section>
<section id="spatial-analysis-2" class="slide level2">
<h2>Spatial analysis</h2>
<h3 id="brainglobe-segmentation-2"><a href="https://github.com/brainglobe/brainglobe-segmentation"><code>brainglobe-segmentation</code></a></h3>

<img data-src="img/brainglobe-segmentation.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"><div class="footer">
<p><a href="https://doi.org/10.1038/s41598-021-04676-9">Tyson, A. L., Vélez-Fort, M., Rousseau, C. V. et al.&nbsp;(2022) “Accurate determination of marker location within whole-brain microscopy images” Scientific Reports, 12, 867</a></p>
</div>
</section>
<section id="visualisation" class="slide level2">
<h2>Visualisation</h2>
<h3 id="brainrender"><a href="https://github.com/brainglobe/brainrender"><code>brainrender</code></a></h3>
<div class="columns">
<div class="column" style="width:33%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/br-mouse.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
</div><div class="column" style="width:33%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/br-human.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
</div><div class="column" style="width:33%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/br-zebrafish.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
</div></div>
<div class="footer">
<p><a href="https://doi.org/10.7554/eLife.65751">Claudi, F. et al.&nbsp;(2021) “Visualizing anatomically registered data with Brainrender” eLife</a></p>
</div>
</section>
<section id="visualisation-1" class="slide level2" data-background-video="img/cellfinder_small.mp4" data-background-video-loop="true">
<h2>Visualisation</h2>
<h3 id="brainrender-1"><a href="https://github.com/brainglobe/brainrender"><code>brainrender</code></a></h3>
<div class="footer">
<p><a href="https://doi.org/10.7554/eLife.65751">Claudi, F. et al.&nbsp;(2021) “Visualizing anatomically registered data with Brainrender” eLife, 10:e65751</a></p>
</div>
</section></section>
<section>
<section id="version-2" class="title-slide slide level1 center">
<h1>Version 2</h1>
<p>Expanding access</p>
</section>
<section id="adding-new-atlases" class="slide level2 smaller">
<h2>Adding new atlases</h2>
<ul>
<li>Latest version of Waxholm rat</li>
<li>Axolotl</li>
<li>Prarie Vole</li>
<li>Princeton RAtlas</li>
<li>Cuttlefish</li>
<li>Developmental Mouse Brain atlas</li>
<li>NHP</li>
<li>Human</li>
</ul>
</section>
<section id="building-novel-atlases" class="slide level2">
<h2>Building novel atlases</h2>

<img data-src="img/blackcap.png" class="quarto-figure quarto-figure-center r-stretch" style="width:120.0%"><div class="footer">
<p><a href="https://github.com/brainglobe/brainglobe-template-builder">github.com/brainglobe/brainglobe-template-builder</a></p>
</div>
</section>
<section id="more-raw-data-processing" class="slide level2">
<h2>More raw data processing</h2>

<img data-src="img/brainglobe-stitch.png" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p><a href="https://github.com/brainglobe/brainglobe-stitch">github.com/brainglobe/brainglobe-stitch</a></p>
</div>
</section>
<section id="consistent-napari-environment" class="slide level2">
<h2>Consistent napari environment</h2>

<img data-src="img/brainrender-napari.png" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p><a href="https://github.com/brainglobe/brainrender-napari">github.com/brainglobe/brainrender-napari</a></p>
</div>
</section>
<section id="support-for-more-data-types" class="slide level2">
<h2>Support for more data types</h2>

<img data-src="img/brainglobe-registration-demo.png" class="quarto-figure quarto-figure-center r-stretch"><div class="footer">
<p><a href="https://github.com/brainglobe/brainglobe-registration">github.com/brainglobe/brainglobe-registration</a></p>
</div>
</section></section>
<section id="brainglobe-website" class="title-slide slide level1 center">
<h1><a href="https://brainglobe.info/" data-preview-link="true" style="text-align: center">BrainGlobe website</a></h1>

</section>

<section>
<section id="tutorials" class="title-slide slide level1 center">
<h1>Tutorials</h1>

</section>
<section id="registering-whole-brain-microscopy-images-with-brainreg" class="slide level2">
<h2>Registering whole brain microscopy images with brainreg</h2>
<p><a href="https://brainglobe.info/tutorials/tutorial-whole-brain-registration.html">Tutorial</a></p>
</section>
<section id="segmenting-structures-in-whole-brain-microscopy-images-with-brainglobe-segmentation" class="slide level2">
<h2>Segmenting structures in whole brain microscopy images with brainglobe-segmentation</h2>
<p><a href="https://brainglobe.info/tutorials/segmenting-1d-tracks.html">Tutorial (1D)</a></p>
<p><a href="https://brainglobe.info/tutorials/segmenting-3d-structures.html">Tutorial (2D/3D)</a></p>
</section>
<section id="detecting-cells-in-large-3d-images-with-cellfinder" class="slide level2">
<h2>Detecting cells in large 3D images with cellfinder</h2>
<p><a href="https://brainglobe.info/tutorials/cellfinder-detection.html">Cell detection tutorial</a></p>
<p><a href="https://brainglobe.info/tutorials/cellfinder-retraining.html">Retraining tutorial</a></p>
</section>
<section id="analysing-cell-positions-in-atlas-space" class="slide level2">
<h2>Analysing cell positions in atlas space</h2>
<p><a href="https://brainglobe.info/tutorials/transform-cells-atlas.html">Tutorial</a></p>
</section>
<section id="visualisation-of-data-in-atlas-space-with-brainrender-and-brainrender-napari" class="slide level2">
<h2>Visualisation of data in atlas space with brainrender and brainrender-napari</h2>
<p><a href="https://brainglobe.info/tutorials/visualise-atlas-napari.html">Tutorial (brainrender-napari)</a></p>
<p><a href="https://github.com/brainglobe/brainrender/tree/main/examples">Example brainrender scripts</a></p>
</section>
<section id="tour-of-other-brainglobe-tools-and-wrap-up" class="slide level2 smaller">
<h2>Tour of other BrainGlobe tools and wrap-up</h2>
<ul>
<li><a href="https://github.com/brainglobe/brainglobe-atlasapi"><code>brainglobe-atlasapi</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-heatmap"><code>brainglobe-heatmap</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-registration"><code>brainglobe-registration</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-space"><code>brainglobe-space</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-stitch"><code>brainglobe-stitch</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-template-builder"><code>brainglobe-template-builder</code></a></li>
<li><a href="https://github.com/brainglobe/brainglobe-utils"><code>brainglobe-utils</code></a></li>
<li><a href="https://github.com/brainglobe/morphapi"><code>morphapi</code></a></li>
</ul>
</section></section>
<section>
<section id="wrap-up" class="title-slide slide level1 center">
<h1>Wrap up</h1>

</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li><a href="https://brainglobe.info/" data-preview-link="true">BrainGlobe website</a></li>
<li><a href="https://forum.image.sc/tag/brainglobe/" data-preview-link="true">Help forum</a></li>
<li><a href="https://brainglobe.zulipchat.com/" data-preview-link="true">Developer forum</a></li>
<li><a href="https://github.com/brainglobe/" data-preview-link="true">GitHub</a></li>
</ul>
<p>You are welcome to contribute to BrainGlobe - get in touch anytime and we will support you!</p>
</section></section>
<section id="thank-you" class="title-slide slide level1 center">
<h1>Thank you!</h1>
<div class="quarto-auto-generated-content">
<p><img src="img/BG_logo.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"numbers":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: true,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 10,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 10,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>